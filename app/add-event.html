<!DOCTYPE html>
<html>
<head>
	<title></title>
</head>
<body>

<input type="text" name="event-name" placeholder="Name">
<input type="text" name="event-topics" placeholder="Topics (separate by comma)">
<input type="text" name="event-level" placeholder="Level">
<input type="text" name="event-speaker" placeholder="Speaker">
<input type="text" name="event-speaker-org" placeholder="Organization">
<input type="date" name="event-date">
<input type="text" name="event-time" placeholder="Time (24h)">
<input type="text" name="event-info" placeholder="Info">
<button id="save-btn">Save</button>


<!-- JQuery Mini -->
<script
  src="https://code.jquery.com/jquery-3.2.1.min.js"
  integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
  crossorigin="anonymous"></script>

<script>

	/*
	Initial page set up..
	on page load, check if local storage has data
	If local storage has data, load and append from local storage
	Else load everything from the data folder..
	*/

	if (localStorage.events == null) {
		//import data from data/events.json
		//input into localStorage.events
		//json file will always have data, which is why this method will always work!
		console.log("localStorage.events is empty");
		$.getJSON("assets/data/events.json").done( function(jData) {
			console.log(jData);
			//put the jData objects into localStorage
			jData = JSON.stringify(jData);
			localStorage.events = jData;
			console.log("localStorage.events successfully populated");
		});		
	} else if (localStorage.events) {
		//load everything from localstorage and populate the div with data..
		console.log("localStorage.events has data");
	}

	//onSave, do this..
	$("#save-btn").on("click", function() {
		console.log("save-btn clicked");
		
		//get value of all items..
		var sId = new Date();
			sId = sId.valueOf();
		var sName = $("input[name='event-name']").val();
		var sTopics = $("input[name='event-topics']").val();
		var sLevel = $("input[name='event-level']").val();
		var sSpeaker = $("input[name='event-speaker']").val();
		var sSpeakerOrg = $("input[name='event-speaker-org']").val();
		var dDate = new Date($("input[name='event-date']").val());
		var sTime = $("input[name='event-time']").val();
		var sInfo = $("input[name='event-info']").val(); //info
		console.log(aTime);
		
		var aTopics = [];
		//get each topic and store it as JSON object
		var aTopics = sTopics.split(",");
		aTopics.forEach( function(i) {
			//write a new object and push it into the array
			//try just making an array first
			aTopics.push(i);
		});
		console.log(aTopics);

		//set time, if input make sense
		var aTime = sTime.split(":", 2); //split sTime into array with two vars
		aTime.forEach( function(i) {
			console.log("aTime Foreach");
			console.log(i.length);
			if (i.length > 2) {
				console.log(i);
				console.log("Invalid time");
				return;
			} else if (i.length <= 2) {
				var index = aTime.indexOf(i); 
				if (index == 0) {
					console.log(i);
					dDate.setHours(i);
				} else if (index == 1) {
					console.log(i);
					dDate.setMinutes(i);
				}
			}
		});
		console.log(dDate);

		//create object to push into JSON..
		var jEventObj = {
			id: sId,
			name: sName,
			level: sLevel,
			speaker: sSpeaker,
			speaker_organization: sSpeakerOrg,
			date: { day: dDate.getDate(), month: dDate.getMonth() , year: dDate.getFullYear() },
			time_24h: { hour: dDate.getHours() , minute: dDate.getMinutes() },
			info: sInfo,
			past: false
		};
		console.log(jEventObj);

		//GOAL: push jEventObj to localStorage
		var localTemp = JSON.parse(localStorage.events);
		localTemp.push(jEventObj);
		localStorage.setItem( "events" , JSON.stringify(localTemp) );

		//append data to DOM..
		//use a function which appears here and on the initial setup..
		
	});

</script>

<!--
	{
		"id": "1",
		"name": "Javascript Bootcamp",
		"topics": { "1" : "Javascript" },
		"level": "Beginner",
		"speaker": "Santiago Donoso",
		"speaker_organization": "KEA",
		"date": { "day": "1", "month": "September", "year": "2017" },
		"time_24h": { "hour" : "15", "minute" : "00" } ,
		"info": "Santiago teaches Javascript in 4 hours!",
		"past": "false"
	}
-->

</body>
</html>